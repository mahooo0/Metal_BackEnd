Technical Specification for Internal CRM Modules

Contents
1. CRUD for Order Type
2. Base CRUD for Order Request Module
3. Registry of Plans (Реєстр планів)
   3.1 CRUD for Metal Brand (Марка металу)
   3.2 Plan Registry CRUD, Search and Sorting
4. All Tasks Module (Всі задачі)
   4.1 Task CRUD, Status and Timeline
   4.2 Get All Tasks – Search, Filter, Sort
   4.3 Date-Based and Responsible User Filters


--------------------------------------------------
1. CRUD for Order Type
--------------------------------------------------

1.1 Data Model
The backend must implement CRUD operations for managing order types.
Each order type contains two fields:
- id: string (UUID generated by backend)
- name: string (name of the order type)

1.2 API Endpoints (REST)

Base URL: /api/order-types

Create Order Type
- Method: POST
- Endpoint: /api/order-types
- Request body: { "name": "Example" }
- Response: { "id": "generated-uuid", "name": "Example" }

Get All Order Types
- Method: GET
- Endpoint: /api/order-types
- Response: list of all order types

Get Order Type By ID
- Method: GET
- Endpoint: /api/order-types/:id
- Response: specific order type by id
- If order type does not exist, return 404 with message "Order type not found"

Update Order Type
- Method: PUT
- Endpoint: /api/order-types/:id
- Request body: { "name": "Updated name" }
- Response: updated order type object

Delete Order Type
- Method: DELETE
- Endpoint: /api/order-types/:id
- Response: { "message": "Order type deleted successfully" }


--------------------------------------------------
2. Base CRUD for "Order Request" Module
--------------------------------------------------

2.1 Field Markers
! – required on create
? – optional
@ – will be added after creation

2.2 Data Structure (Order Request)

DATA_STRUCTURE
- Title !
- Description !
- Files ?
- CreatedAt !
- OrderType !
- CreatedBy !
- StartTime (month, day, hour)
- EndTime (month, day, hour)
- CounteragentId
- Status (one of the following):
  - Нові замовлення
  - Прорахунок
  - Уточнення
  - Додаткові послуги
  Default status: Нові замовлення
- UpdatedAt
- Comments @ (array of comment objects)
- IndexLike ! (example: 653518)
- Tasks @ (assigned user tasks; optional; will be added after creating)

Note: This is the base structure. It will expand after additional modules are implemented.

2.3 Required Backend Functionality
The backend must implement full CRUD (Create, Read, Update, Delete) for the Order Request entity.

2.4 Additional Required Operations
- PATCH endpoint to update status only.
- Endpoint to add a comment.
- Endpoint to upload files and attach them to the order.
- Support for search and sorting parameters in the Get All endpoint.

2.5 API Requirements

Create Order Request
Required fields:
- Title
- Description
- OrderType
- CreatedBy
- CreatedAt
- IndexLike

Optional fields:
- Files
- StartTime
- EndTime
- CounteragentId

Default fields set by backend:
- Status = "Нові замовлення"
- UpdatedAt

Fields added after creation:
- Comments
- Tasks

Get All Order Requests
The Get All endpoint must support filtering and sorting through query parameters.

Search / filter parameters:
- Дата створення (CreatedAt)
- Тип заявки (OrderType)
- Замовник (CounteragentId)
- CreatedBy
- Responsible (assignee, if exists)
- IndexLike
- General text search by Title and Description

Sorting parameters:
- sortBy: CreatedAt, UpdatedAt, OrderType, CreatedBy, CounteragentId
- sortDirection: ASC or DESC

Get Single Order Request by ID
- Returns the full object including comments and attached files.

Update Order Request
- All non-restricted fields may be updated.
- CreatedAt, CreatedBy, and IndexLike must NOT be changed after creation.

Delete Order Request
- May be implemented as soft delete or hard delete (to be defined by backend team).

Patch Status
- A dedicated endpoint must allow changing status only.
- Allowed status values: Нові замовлення, Прорахунок, Уточнення, Додаткові послуги.
- Backend must validate allowed transitions if such business rules exist.

Add Comment
- A dedicated endpoint to append a comment to the order request.

Add File
- A dedicated endpoint to upload and attach files to the order request.


--------------------------------------------------
3. Registry of Plans (Реєстр планів)
--------------------------------------------------

3.1 CRUD for Metal Brand (Марка металу)

3.1.1 Data Structure for Metal Brand
- id (string, UUID; required; generated by backend)
- name (string; required)

3.1.2 Backend Requirements for Metal Brand
- Implement full CRUD (Create, Read, Update, Delete) for Metal Brand.
- "name" must be unique.
- Get All endpoint must support search and sorting by name and createdAt.

3.2 Main Data Structure for "Plan Registry" (Реєстр планів)

DATA_STRUCTURE
- RegistrationDate (required)
- PlanNumber (required)
- OrderNumber (required; references Orders.index)
- Customer (required; from Order.Counteragent)
- MetalBrandId (required; references Metal Brand)
- MetalThickness (required)
- Files (optional; list of attachments)

Notes:
- RegistrationDate is the date the plan was added to the system.
- PlanNumber must be unique within the registry.
- Customer is automatically resolved from the referenced Order.
- Files is an optional list of uploaded attachments with metadata.

3.3 Required Backend Functionality for "Plan Registry"
The backend must implement full CRUD: Create, Read (Get All + Get by ID), Update, and Delete for plan records.

Create Plan Record
Required fields:
- RegistrationDate
- PlanNumber
- OrderNumber
- Customer
- MetalBrandId
- MetalThickness

Optional fields:
- Files

Customer must be derived automatically from the OrderNumber link.
If OrderNumber is invalid or does not exist, the backend must return an error.

3.4 Get All Plan Records – Search, Filter, Sort
The Get All endpoint for Plan Registry must support advanced search, filtering, and sorting parameters.

Search / filter parameters:
- Search (general text search applied to PlanNumber, OrderNumber, Customer name)
- CreatedTime (filter by RegistrationDate; support exact date, range, or from–to)
- CounteragentId (filter by referenced Order.Counteragent)
- CreatedBy (filter by the user who created the plan record)

Sorting parameters:
- sortBy (accepted values: RegistrationDate, PlanNumber, OrderNumber, Customer, CreatedBy)
- sortDirection (ASC or DESC)

Requirements:
- All parameters are optional.
- Multiple parameters may be used together (for example: filter by CounteragentId and sort by date).
- If no sorting is provided, default sorting should be by RegistrationDate DESC.
- General search should look at PlanNumber, OrderNumber, and Customer name simultaneously.

3.5 Get Plan Record by ID
- Returns full data including attached files.

3.6 Update Plan Record
- Allowed updates: all fields except PlanNumber if the system requires immutability for the plan number.
- Customer must always stay linked to the corresponding Order.

3.7 Delete Plan Record
- May be implemented as soft delete or hard delete, depending on system requirements.

3.8 Additional Operations

File Upload
- Backend must provide an endpoint for uploading files and attaching them to a Plan Record.
- Stored metadata must include: filePath, fileName, fileSize, uploadedAt.

Validation Rules
- RegistrationDate must be a valid date.
- PlanNumber must be unique.
- MetalThickness must be numeric.
- MetalBrandId must reference an existing Metal Brand.
- OrderNumber must match an existing order.
- Files: validate allowed file types and maximum size.

System Notes
- All timestamps must use a unified format (ISO 8601 recommended).
- IDs should be UUID unless otherwise specified.
- Files must be stored in a centralized storage module.
- Customer field must always reflect Order.Counteragent data.


--------------------------------------------------
4. “All Tasks” Module (Всі задачі)
--------------------------------------------------

4.1 General Requirements
The backend must implement a full CRUD module for tasks, including additional operations such as updating status, editing start and end dates, and managing timeline records.

4.2 Field Markers
! – required on create
? – optional
@ – added after creation

4.3 Task Type CRUD (Tusks type)
The system must support a separate directory of task types.

TaskType data structure:
- id: string (UUID; generated by backend)
- name: string (required; unique)

Backend must implement full CRUD for TaskType and provide a way to reference TaskType from tasks via Type field.

4.4 Task Data Structure

TASK_STRUCTURE
- OrderId !
- Title !
- Description !
- CreatedAt !
- StartExecutionDate !
- Type ! (references TaskType)
- CreatedBy !
- ResponsibleUser ?
- Comments @ []
- Files @
- Timeline @ [] (default empty; contains Timeline_item entries)
- StartTime (month, day, hour) !
- EndTime (month, day, hour) !
- Status (allowed values):
  Planning | Backlog | Todo | InProgress | Прорахунок | Done | Canceled

4.5 Timeline Item Structure
Each timeline entry describes an action performed on the task.

TIMELINE_ITEM
- ActionName (allowed: Start, Stop, End, Restart)
- Time (timestamp of action)

The backend must append Timeline_item entries automatically when certain actions occur (for example: start, stop, status change).

4.6 Required Backend Operations for Tasks

CRUD for Tasks
- Create Task
- Get All Tasks (with search, filters, sorting)
- Get Task by ID
- Update Task
- Delete Task

Additional Patch Operations
- Patch Status
- Patch StartDate and EndDate

Timeline Management
- Backend must add timeline entries whenever task execution changes state (start, end, restart).
- Backend may allow adding custom timeline items if required.

4.7 Validation Rules
Required fields must be provided on creation:
- OrderId
- Title
- Description
- CreatedAt
- StartExecutionDate
- Type
- CreatedBy
- StartTime
- EndTime

Additional rules:
- Status must always be one of the allowed values.
- All dates must be valid.
- If ResponsibleUser is provided, backend must validate the reference.
- Type must reference an existing TaskType.

4.8 Get All Tasks – Search, Filter, Sort
The Get All endpoint must support advanced filtering and sorting.

Search / filter parameters:
- GeneralSearch (applies to Title, Description)
- StartExecutionDate (Початок виконання)
- CreatedAt (Дата створення)
- TaskType (Тип задачі)
- Counteragent (Замовник) — via linked Order
- CreatedBy (Створив)
- ResponsibleUser (Відповідальний)
- Status

Sorting parameters:
- sortBy (allowed: CreatedAt, StartExecutionDate, Type, Status, ResponsibleUser, CreatedBy)
- sortDirection (ASC or DESC)

Notes:
- All search parameters are optional.
- Multiple filters may be used simultaneously.
- Default sorting: CreatedAt DESC.

4.9 File Handling for Tasks
The backend must allow uploading and attaching files to tasks.
Files must have metadata:
- fileName
- fileSize
- path
- uploadedAt

File validation rules must be implemented (file type, max size, etc.).

4.10 Comments Handling for Tasks
The backend must support adding comments to a task.
Each comment must contain:
- id
- authorId
- text
- createdAt

The backend sets createdAt automatically.

4.11 Date-Based and Responsible User Filters for Tasks
The backend must support extended filtering options for retrieving tasks. These options must be available through the Get All Tasks endpoint or through separate endpoints. All parameters are optional and may be combined.

Filter Tasks by Year
- The system must allow retrieving all tasks created within a specific year.
- Parameter: year
- Example: year=2025
- Filtering rule: CreatedAt belongs to the given year.

Filter Tasks by Month
- The system must allow retrieving all tasks created within a specific month.
- Parameters: year, month
- Example: year=2025, month=03
- Filtering rule: CreatedAt belongs to the given year and month.

Filter Tasks by Day
- The system must allow retrieving all tasks created on a specific day.
- Parameters: year, month, day
- Example: year=2025, month=03, day=14
- Filtering rule: CreatedAt matches the exact date.

Filter Tasks by Responsible User
- The system must allow retrieving tasks assigned to a specific responsible user.
- Parameter: responsibleUserId
- Filtering rule: ResponsibleUser equals the provided ID.

Combination of Filters
- All these filters must be combinable with existing parameters such as:
  - General search
  - StartExecutionDate
  - CreatedAt
  - TaskType
  - Counteragent
  - CreatedBy
  - Status
  - Sort parameters

Notes for Combined Filters
- If only year is provided: return all tasks for that year.
- If year + month are provided: return tasks for that month.
- If year + month + day are provided: return tasks for that exact day.
- If responsibleUserId is provided without date filters: return all tasks for that user.
- If combined with date filters: return tasks for that user within the specified date range.

Performance Requirements
- The backend must implement efficient querying and indexing to support date-based filters.
- Date filtering must use CreatedAt field unless StartExecutionDate is specified for an alternative filter.

4.12 System Notes for Tasks
- IDs must follow UUID or system-defined format.
- Timestamps must follow a unified format (ISO 8601 recommended).
- Timeline array must exist even if empty.
- Tasks are linked to Orders, therefore the backend must validate OrderId on creation and updates.
